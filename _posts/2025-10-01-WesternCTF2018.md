---
layout: post
title:  "WesternCTF 2018"
date:   2025-10-01 12:00:00 +0700
tags: Writeup SSTI WesternCTF2018
categories: jekyll update
---

# SSTI 

## [WesternCTF 2018] Shrine 

![image](https://hackmd.io/_uploads/rkJaZt1aex.png)

Bài này bị `SSTI` tại hàm `safe_jinja` khi mà chặn blacklist thì nó đã viết sai cú pháp, cú pháp đúng phải là **&#123;% %&#125;

Lí do tác giả muốn set trước khi nối vào trước user input để trở thành **&#123;&#123;% set config=None %&#125;&#125; &#123;&#123;% set self=None %&#125;&#125; + `<user_input>`

Cho nên mình thử payload là: &#123;&#123;7*7&#125;&#125;

![image](https://hackmd.io/_uploads/H16rqZKnxg.png)

Từ đây, mình có thể dùng `url_for` thì nó là 1 helper trong Flask được dùng để tạo URL động và do ko có chặn `__globals__` nên mình có thể dùng nó.

![image](https://hackmd.io/_uploads/S1gR5ZFhlg.png)

Thì thấy có `current_app`, do trong ứng dụng có `app=flask.Flask(__name__)`. 

Cho nên mình có thể chạy payload như sau: 

![image](https://hackmd.io/_uploads/Bk5Yi-Yhlx.png)



