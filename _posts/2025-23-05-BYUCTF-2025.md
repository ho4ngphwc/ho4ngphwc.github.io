---
layout: post
title:  "BYUCTF 2025"
date:   2025-23-05 22:00:00 +0700
tag: Writeup, BYUCTF
categories: jekyll update
---

# Wembsoncket

* Giao diện web

![image](https://hackmd.io/_uploads/Syht5Oa-ll.png)

Mình được cung cấp 1 source public.

Sau khi tìm hiểu đọc thì thấy có file quan trọng là:
- `adminBot.js`
- `server.js` 

Trong file `adminBot.js` thì khi mình gửi 1 URL hợp lệ thì Bot sẽ kiểm tra và click vào cái link của mình.

Và khi đó nó sẽ set cookie là `admin`.

![image](https://hackmd.io/_uploads/HyrHo_6Wgg.png)

Mà adminCookie được ký bằng `userId` là `admin`

![image](https://hackmd.io/_uploads/HJhPsO6-ex.png)

Ở file `server.js`, thì nó có như sau:
![image](https://hackmd.io/_uploads/ryx9i_aZgx.png)

Nếu mình gửi tới endpoint `/getFlag` thì nó sẽ kiểm tra đúng là `admin` thì nó sẽ trả về flag 

Bài này được thực hiện kết hợp là XSS +  CSWSH (Cross-Site WebSocket Hijacking).

Mình sẽ cho bot nhấp link từ server mình host bằng `ngrok`, trong đó có chứa 1 file fetch tới endpoint `/getFlag`. 

Nghĩa là khi truy cập tới endpoint `/getFlag` thì chỉ có bot mới nhấp được và sau đó nó trả về trên server của mình.

![image](https://hackmd.io/_uploads/rkUEaOaWxg.png)

Sau đó mình host bằng ngrok

![image](https://hackmd.io/_uploads/SkAST_pZxe.png)

Rồi đưa link cho Bot

![image](https://hackmd.io/_uploads/Sk15p_aWeg.png)
Bot click thành công!

![image](https://hackmd.io/_uploads/Sygo6_p-ee.png)

Sau khi decode thì được.

![image](https://hackmd.io/_uploads/rJ23TOT-eg.png)

`Flag : byuctf{CSWSH_1s_a_b1g_acr0nym}`

# JWTF 

* Giao diện web

![image](https://hackmd.io/_uploads/SkEEwuabeg.png)

Nó trả về `Hello World!` và cũng được cung cấp 1 source public. 

Bài này được viết bằng python và xác thực người dùng bằng JWT. 

Được ký qua `APP_SECRET`, là 1 chuỗi sinh ra 1 chuỗi random 32 ký tự đổi qua hex thành 64 ký tự. 

Cho nên mình không thể brute-force secret này được...

Mình được cung cấp 1 token hợp lệ trong `/jrl`

![image](https://hackmd.io/_uploads/rk_eduabxl.png)

Decode ra thì được: 

![image](https://hackmd.io/_uploads/rJwz_Oabgx.png)

Thì trong source có logic như sau: 

![image](https://hackmd.io/_uploads/BkJwuup-le.png)

Ở endpoint này thì mình không thể dùng được vì phải có được token của admin và được ký bằng `SECRET_ADMIN` cho nên là không thể tìm được cái secret đó để ký lại. 

![image](https://hackmd.io/_uploads/HJR-Fd6bee.png)

Còn endpoint này, ở dòng 44 nó thực hiện bỏ dấu `=` thành khoảng trống thì này liên quan đến Base64-encode và Base64URL-encode.

Và nó kiểm tra rằng nếu JWT đó có payload là `admin` thì trả về flag. Nhưng trước đó có điều kiện là ko được là session trong /jrl nghĩa là ko được giống. 

Thì bài này liên quan đến 1 vấn đề là sửa bit trong Base64URL-encode.

Ý tưởng được dựa vào bài viết này: [link](https://medium.com/%40mark_huber/decoding-the-jwt-anomaly-when-changing-a-tokens-last-character-doesn-t-break-verification-d6ab68627afb)

Nên sau khi tính toán thì mình thay đổi ký tự cuối cùng token là '`w`' thành '`x`' nghĩa là nó gần nhau và việc thay đổi 1 bit cũng ko làm ảnh hưởng đến token gốc.

![image](https://hackmd.io/_uploads/By1E9dpbex.png)

`Flag : byuctf{idk_if_this_means_anything_but_maybe_its_useful_somewhere_97ba5a70d94d}`

# Cooking Flask 

* Giao diện web 

![image](https://hackmd.io/_uploads/Sy19k_a-lx.png)

Bài này có nhiều tham số mà còn có lưu thông tin thông qua tham số `tag` nên mình nghĩ nó bị **SQLi**

Nên mình thử thêm payload đầu tiên để test là `'` vào trong tham số `tag`

![image](https://hackmd.io/_uploads/S1_5gda-xg.png)

Nó nhảy ra lỗi như sau: 

![image](https://hackmd.io/_uploads/rJssedTbge.png)

Vậy thì mình đoán câu query như sau:
```bash=
SELECT <cai_gi_do> FROM <table_name> WHERE tag LIKE ('%<input>%')
```
Payload thứ hai mình truyền vào như sau: 

![image](https://hackmd.io/_uploads/H107Zu6bee.png)

Nó trả về tất cả qua tham số `tags`

![image](https://hackmd.io/_uploads/Bk4uWdpZxe.png)

Từ đây mình có thể xác định đây chắc chắn là bug SQLi Error Base (String query)

## Xác định số cột trong câu query gốc

![image](https://hackmd.io/_uploads/HkYA-ua-gl.png)

Nó trả về lỗi như sau:
![image](https://hackmd.io/_uploads/HkU1M_pbel.png)

Là `should be between 1 and 8`, như vậy là có 8 cột.

## Xác định cột nào có thể trích xuất được thông tin qua `UNION SELECT`

![image](https://hackmd.io/_uploads/B17wfuaWeg.png)

Nó trả về là các cột trong câu query của mình ko thể là NULL.
![image](https://hackmd.io/_uploads/SyI_Mdable.png)

Cho nên mình sẽ thay **'a'** vào từng cột để xác định xem cột nào là Chuỗi.

Sau khi đọc kỹ vào thì thấy lỗi trả về lun các cột trong câu query 😊

![image](https://hackmd.io/_uploads/H1HWXdpZeg.png)

**recipe_id, recipe_name, date_created, recipe_image, recipe_description, instructions, tags, user_id = recipe_data**

Từ đây mình đoán như sau:
- recipe_id --> INT 
- recipe_name --> STRING
- data_created --> DATE 
- recipe_image --> unknown
- recipe_description --> STRING
- intructions --> STRING 
- tags --> STRING (theo kiểu JSON)
- user_id = recipe_date --> INT 

Như vậy mình truyền lại như sau:

![image](https://hackmd.io/_uploads/rJPNr_pZxg.png)

Như vậy thì mình đã truyền payload mà nó đã trả về các ký tự mình tự chèn vào. 

Nên mình thực hiện xem có bao nhiêu table trong DB hiện tại.

![image](https://hackmd.io/_uploads/HymArOT-eg.png)

Mình thấy có table `user`, tiếp tục khai thác cột trong table `user`. 

![image](https://hackmd.io/_uploads/r1KYUOTbxx.png)

Mình thấy có cột username và password nên mình sẽ trích xuất xem có gì. 

![image](https://hackmd.io/_uploads/S171D_T-el.png)

`Flag : byuctf{pl34s3_p4r4m3t3r1z3_y0ur_1nputs_4nd_h4sh_p4ssw0rds}`

# Willy Wonka Web

* Giao diện web 

![image](https://hackmd.io/_uploads/BkX9ivpZgx.png)

Mình cũng được cung cấp 1 source public. 

Bài này được xây dựng theo 1 mô hình: **Client --> Proxy --> Backend**

![image](https://hackmd.io/_uploads/SJu82Dabgx.png)

![image](https://hackmd.io/_uploads/SJKB3vaWxx.png)

Proxy được sử dụng trong bài này là `Apache`, nghĩa là khi client gửi kèm theo `http://url/name/test` --> đi qua proxy match với dòng 11 trong file `httpd.conf` nó sẽ được truyền vào theo `http://backend:3000/?name=test` 

![image](https://hackmd.io/_uploads/S1e23PT-xx.png)

Còn trang trả về **It works!** là trang mặc định khi proxy ko thấy rule nào match nên nó trả về trang mặc định. 

Đọc trong file `Dockerfile` thì mình thấy có config như sau: 

![image](https://hackmd.io/_uploads/B1Rb6wTZlx.png)

Nó dùng `httpd:2.4.55`, nó liên quan đến **CVE-2023-25690**.
Bài này khai thác dựa trên bài github này: [link](https://github.com/thanhlam-attt/CVE-2023-25690)

Đầu tiên mình sẽ test xem nó có cho thực hiện CRLF (%0d%0a) hay ko? (%0d --> \r) và (%0a --> \n)

![image](https://hackmd.io/_uploads/rJYZ0DTbgx.png)

Nghĩa là mình đã chèn 1 trường `Foo: barr` vào trong header

Sau khi decode header sẽ được hiểu như sau:

![image](https://hackmd.io/_uploads/r1LH0wp-ee.png)

Đọc trong file `server.js` thì mình thấy để lấy được flag thì phải có header là `a` hoặc `A` là `admin` thì mới trả về flag.

Cho nên mình sẽ thực hiện `HTTP Request Smuggling`

![image](https://hackmd.io/_uploads/S1OmJuabgl.png)

Sau khi decode header thì nó sẽ như sau: 

![image](https://hackmd.io/_uploads/BkNf1dpZgl.png)

`Flag : byuctf{i_never_liked_w1lly_wonka}`

# Red This

* Giao diện của web

![image](https://hackmd.io/_uploads/B1FTXvTZee.png)

Mình được cung cấp thêm 1 source public.
Sau khi đọc source thì phát hiện ra thêm có endpoint.
- **/login**
- **/register**

Ở route `/` thì mình có các hàm định nghĩa như sau:
![image](https://hackmd.io/_uploads/SJ_wVDp-gx.png)

Trong `root` có `getAdminOptions` thì hàm này trả về theo dạng là `key => value`, dựa trên `username` là `key`

Và trong route `/get_quote`, ở dòng 37 là xác định `username` của người đang thực hiện, dòng 38 là lấy `famous_person` từ trong 1 cái form và form có chứa nhiều nội dụng từ file `index.html`.

![image](https://hackmd.io/_uploads/H197Lv6Zle.png)

Sau đó dòng 39, biến `quote` sẽ thể hiện là danh sách chứa nội dung thông qua biến `person` đã được lưu.
Nghĩa là biến `person` đang chứa các giá trị của các tag `option`

Ở dòng 40-43, thì nếu `flag` nằm trong list `person` thì và `username` khác `admin` thì mình không lấy được flag.

Ở dòng 44, nếu ko nằm trong hai trường hợp trên thì `adminOptions` được gọi tới mà `adminOptions` lại trả về theo dạng `key => value` nếu mình biết được `key` thì có thể biết được `value`.


### Endpoint `/login`

![image](https://hackmd.io/_uploads/S1ct_D6Zxx.png)

Ở dòng 89-90, thể hiện cách check `username` và `password` trong database bằng hàm `getData()`. 
Hàm này hoạt động theo kiểu `key => value`, dòng 90 dev đã lưu `key` là `username_password`, thì từ đây mình đã biết được khóa để lưu password.

### Endpoint `/register`

![image](https://hackmd.io/_uploads/HkOo9PpWel.png)

Ở dòng 70, dev cũng gợi ý ra là `passwordKey` được lưu theo dạng `username_password`

## Vậy nếu mình truyền vào key `admin_password` thì `adminOptions` có trả về password ko? 

![image](https://hackmd.io/_uploads/SJnfqD6-lg.png)

Như vậy mình đã lấy được credentials của admin là `admin:I_HopeYou4re8admin_iLoveTechn070g_9283910`

Như vậy thì mình đã có thể login vào tài khoản admin.

![image](https://hackmd.io/_uploads/rkkGoPpZex.png)

`Flag : byuctf{al1w4ys_s2n1tize_1nput-5ed1s_eik4oc85nxz}`

