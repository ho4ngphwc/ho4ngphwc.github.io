---
layout: post
title:  "SSRF"
date:   2025-08-07 12:00:00 +0700
tags: PortSwigger
categories: jekyll update
---

# SSRF

## LAB01 - SSRF cơ bản chống lại server local 

Lab này có chức năng check stock, và khi check stock thì nó sẽ gọi tới 1 API 

![image](https://hackmd.io/_uploads/B1dWl0bDgx.png)

Nên mình truyền payload để gọi tới internal => `http://localhost/admin` 

![image](https://hackmd.io/_uploads/BkrVxCWvle.png)

## LAB02 - SSRF cơ bản chống lại hệ thống back-end khác 

Lab này mình sẽ tìm xem địa chỉ của server nội bộ là bao nhiêu. Vì nó cho biết địa chỉ là `192.168.0.X` và chạy ở port 8080. 

Khi kiểm tra chức năng check stock => thì nó sẽ gọi tới 1 API có địa chỉ như sau: 

![image](https://hackmd.io/_uploads/B1xpHkMPgl.png)

Từ đó, mình có thể brute-force: 

![image](https://hackmd.io/_uploads/BJSqLJfvxl.png)

Sau khi brute-force thì tìm ra địa chỉ IP như sau:

![image](https://hackmd.io/_uploads/H1YyOyMPex.png)

![image](https://hackmd.io/_uploads/Skb9d1MDee.png)

## LAB03 - Blind SSRF với phát hiện out-of-band 

Lab này khi mà hiển thị 1 trang web thì nó dùng trường Reference để tham chiếu đến 1 URL 

![image](https://hackmd.io/_uploads/SyYljJMvlx.png)

Cho nên mình sẽ thử tiêm vào đây một URL do attacker dựng sẵn sẽ như thế nào? 

![image](https://hackmd.io/_uploads/BJBkj1zwxg.png)

Khi đó nó trả về các DNS 

![image](https://hackmd.io/_uploads/H1WXjJMDex.png)

## LAB04 - SSRF với bộ lọc đầu vào dựa trên blacklist 

Lab này trong chức năng check stock cũng gọi tới 1 URL nhưng nó hoàn toàn được filter các từ khóa như: `localhost`, `127.0.0.1` 

Nhưng mà vẫn có thể bypass được vì `127.1` cũng được hiểu là `127.0.0.1` và chữ `a` cũng có thể bị chặn theo pattern match nào đó mà mình ko bít nên sẽ thay `a` thành `A` 

![image](https://hackmd.io/_uploads/Hk1ya1Mvlg.png)

## LAB05 - SSRF với kỹ thuật vượt qua bộ lọc thông qua lỗ hổng chuyển hướng mở (open redirection) 

Sau khi truy cập thì thấy có lỗi chuyển hướng như sau: 

![image](https://hackmd.io/_uploads/ryjSCJfveg.png)

Và chức năng check stock cũng gọi tới 1 URL nên mình thay đổi path rồi cho chức năng checkstock gọi tới là được. 

![image](https://hackmd.io/_uploads/ryM11xMvgl.png)

## LAB06 - Blind SSRF kết hợp khai thác lỗ hổng Shellshock 

Lỗ hổng shellshock là một lỗ hổng nghiêm trọng trong Bash shell, cho phép thực thi lệnh tùy ý nếu dữ liệu điều khiển môi trường (như HTTP headers) được xử lý sai.

Mình dùng 1 extension trong Burp Pro để có thể khai thác Blind SSRF là Collaborator Everywhere. 

Khi cài extension này và đồng thời lướt web thì nó sẽ tự động scan. 

![image](https://hackmd.io/_uploads/HkUzMezwxg.png)

Ngoài trường Reference thì vẫn còn trường User-Agent cũng dính SSRF. 

Cho nên sau đó, mình truyền payload vào User-Agent rồi mình brute-force địa chỉ trong trường Reference. 

![image](https://hackmd.io/_uploads/B1jBElGwgx.png)

Sau đó, kiểm tra DNS trả về. 

![image](https://hackmd.io/_uploads/SkloVezPxe.png)

## LAB07 - SSRF với whitelist-based input filter 

Lab này nhắm vào phần phân tích URL. Do đã bị chặn `localhost` và chỉ cho phép `stock.weliketoshop.net` bằng whitelist. 
Nên mình thử payload như sau: `http://localhost@stock.weliketoshop.net` truyền như vậy để nó hiểu username localhost thuộc về domain này. 

Nhưng thêm dấu `#` để nó đóng URL lại nhưng vẫn hiểu đúng có domain cho phép trong whitelist. 

![image](https://hackmd.io/_uploads/rkkqtxMDxx.png)

