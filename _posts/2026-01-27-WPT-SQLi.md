---
layout: post
title:  "SQL Injection"
date:   2026-01-27 14:51:00 +0700
tags: WPT
categories: jekyll update
---

## ğŸ§ª Level 1

---

![image.png](/assets/images/WPT/SQLi/image.png)

Äáº§u tiÃªn mÃ¬nh sáº½ review source code cá»§a challange nÃ y. 

![image.png](/assets/images/WPT/SQLi/image%201.png)

Quan sÃ¡t cÃ¢u query thÃ¬ mÃ¬nh tháº¥y nÃ³ Ä‘ang thá»±c hiá»‡n viáº¿t ná»‘i chuá»—i vá»›i dáº¥u **`'`** 

```sql
**SELECT username FROM users WHERE username='$username' AND password='$password';**
```

ÄÃ¢y lÃ  cÃ¡ch viáº¿t nguy hiá»ƒm, khi Ä‘Ã³ attacker cÃ³ thá»ƒ thao tÃºng báº±ng cÃ¡ch nháº­p vÃ o **`' OR 1=1#`** Ä‘á»ƒ lÃ m cho cÃ¢u query bá»‹ hiá»ƒu sai nhÆ°ng váº«n há»£p lá»‡. 

![image.png](/assets/images/WPT/SQLi/image%202.png)

## ğŸ§ª Level 2

---

![image.png](/assets/images/WPT/SQLi/image%203.png)

Quan sÃ¡t cÃ¢u query thÃ¬ ta tháº¥y.

```sql
**SELECT username FROM users WHERE username="$username" AND password="$password";**
```

TÆ°Æ¡ng tá»± nhÆ° level 1 nhÆ°ng nÃ³ Ä‘Ã£ thay Ä‘á»•i báº±ng dáº¥u **`"`** 

![image.png](/assets/images/WPT/SQLi/image%204.png)

## ğŸ§ª Level 3

---

![image.png](/assets/images/WPT/SQLi/image%205.png)

Quan sÃ¡t cÃ¢u query level nÃ y.

```sql
**SELECT username FROM users WHERE username=LOWER("$username") AND password=MD5("$password");**
```

NhÆ°ng nhÃ¬n chung thÃ¬ nÃ³ cÅ©ng hoÃ n toÃ n viáº¿t ná»‘i chuá»—i, nhÆ° váº­y thÃ¬ hoÃ n toÃ n ta cÃ³ tháº¿ thao Ä‘Ã³ng chuá»—i báº±ng cÃ¡ch **`") OR 1=1#`** 

![image.png](/assets/images/WPT/SQLi/image%206.png)

## ğŸ§ª Level 4

---

![image.png](/assets/images/WPT/SQLi/image%207.png)

Sau khi review source code thÃ¬ tháº¥y hoÃ n toÃ n nÃ³ Ä‘Ã£ filter táº¡i hÃ m **`CheckValid()`** , hÃ m nÃ y thá»±c hiá»‡n kiá»ƒm tra tháº¥y **`"`** thÃ¬ return **`false`** 

Quan sÃ¡t cÃ¢u query mÃ¬nh tháº¥y 

```sql
**SELECT username FROM users WHERE username=LOWER("$username") AND password=MD5("$password");**
```

NhÆ° váº­y thÃ¬ nÃ³ hoÃ n toÃ n váº«n viáº¿t theo cÃ¡ch cÅ©. 

NhÆ°ng náº¿u ra sao náº¿u mÃ¬nh cho dáº¥u `"` Ä‘Æ°á»£c hiá»ƒu ngáº§m lÃ  kÃ½ tá»±.

Khi Ä‘Ã³ mÃ¬nh truyá»n vÃ o dáº¥u **`\`** lÃºc Ä‘Ã³ dáº¥u **`"`** sáº½ Ä‘Æ°á»£c hiá»ƒu ngáº§m lÃ  kÃ½ tá»± torng chuá»—i.

CÃ¢u query sáº½ thÃ nh nhÆ° sau:

```sql
**SELECT username FROM users WHERE username=LOWER("\") AND password=MD5("$password");**
```

NhÆ° váº­y chuá»—i Ä‘oáº¡n **`username`** sáº½ báº¯t Ä‘áº§u tá»« **`"\" AND password=MD5("`** vÃ  biáº¿n **`$password`** mÃ¬nh sáº½ dá»… dÃ ng thao tÃºng theo Ã­ mÃ¬nh.

NhÆ° váº­y thÃ¬ mÃ¬nh hoÃ n toÃ n Ä‘Ã£ cÃ³ thá»ƒ láº¥y **`password`** admin nhÆ°ng nÃ³ Ä‘Ã£ bá»‹ hash.

![image.png](/assets/images/WPT/SQLi/image%208.png)

Quan sÃ¡t thÃ¬ mÃ¬nh tháº¥y nÃ³ chá»‰ check **`username`** khi login táº¡i **`$login_user = $row['username']);`** , nhÆ° váº­y náº¿u mÃ¬nh cho nÃ³ hiá»ƒu **`username`** Ä‘ang lÃ  admin thÃ¬ sao â“â“ 

![image.png](/assets/images/WPT/SQLi/image%209.png)

## ğŸ§ª Level 5

---

![image.png](/assets/images/WPT/SQLi/image%2010.png)

Quan sÃ¡t source thÃ¬ tháº¥y cÃ¢u query sáº½ thá»±c hiá»‡n kiá»ƒm tra **`username`** cÃ³ trong db hay ko. Náº¿u cÃ³ thÃ¬ má»›i láº¥y **`password`** rá»“i Ä‘em Ä‘i so sÃ¡nh vá»›i **`password`** Ä‘Ã£ Ä‘Æ°á»£c hash trong db.

NhÆ°ng váº«n cÃ³ thá»ƒ bá»‹ khai thÃ¡c do cÃ¢u query váº«n viáº¿t dáº¡ng cÅ©.

Sáº½ ra sao náº¿u mÃ¬nh thao tÃºng cho cÃ¢u query hiá»ƒu user admin cÃ³ password lÃ  do nháº­p vÃ o ?

![image.png](/assets/images/WPT/SQLi/image%2011.png)

Khi mÃ¬nh thá»±c hiá»‡n cÃ¢u query trÃªn thÃ¬ nÃ³ hoÃ n toÃ n hiá»ƒu ráº±ng Ä‘ang **`SELECT`** vá»›i hai cá»™t tÆ°Æ¡ng á»©ng vá»›i cÃ¢u query á»Ÿ Ä‘áº§u.

![image.png](/assets/images/WPT/SQLi/image%2012.png)

## ğŸ§ª Level 6

---

![image.png](/assets/images/WPT/SQLi/image%2013.png)

Äáº¿n vá»›i level 6 nÃ y thÃ¬ nÃ³ sáº½ hiá»ƒn thá»‹ bÃ i blog thÃ´ng qua trÆ°á»ng **`id`** vÃ  nÃ³ cháº·n qua hÃ m **`real_escape_string`** 

HÃ m nÃ y sáº½ filter qua cÃ¡c kÃ½ tá»± theo document cá»§a PHP.

![image.png](/assets/images/WPT/SQLi/image%2014.png)

Vá»›i cÃ¢u query nhÆ° sau:

```sql
**SELECT content FROM posts WHERE id=$id;**
```

Khi Ä‘Ã³ mÃ¬nh truyá»n **`UNION`** Ä‘á»ƒ xÃ¡c Ä‘á»‹nh version.

![image.png](/assets/images/WPT/SQLi/image%2015.png)

MÃ¬nh xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c version lÃ  **`8.0.45`** 

NhÆ° váº­y tá»« Ä‘Ã¢y mÃ¬nh cáº§n xÃ¡c Ä‘á»‹nh tÃªn db. 

![image.png](/assets/images/WPT/SQLi/image%2016.png)

MÃ¬nh Ä‘Ã£ láº¥y Ä‘Æ°á»£c tÃªn db lÃ  **`posts_db`** 

VÃ  mÃ¬nh cáº§n xÃ¡c Ä‘á»‹nh trong db cÃ³ bao nhiÃªu table vÃ  cÃ¡c table tÃªn lÃ  gÃ¬ â“â“ 

![image.png](/assets/images/WPT/SQLi/image%2017.png)

MÃ¬nh Ä‘Ã£ láº¥y Ä‘Æ°á»£c 2 table lÃ  **`posts`** vÃ  **`secret6`** . NhÆ° váº­y mÃ¬nh sáº½ táº­p trung vÃ o table **`secret6`** 

Tiáº¿p theo mÃ¬nh cáº§n xÃ¡c Ä‘á»‹nh table **`secret6`** sáº½ cá»™t gÃ¬ â“

![image.png](/assets/images/WPT/SQLi/image%2018.png)

Do mÃ¬nh khÃ´ng thá»ƒ truyá»n tháº³ng tÃªn table nÃªn mÃ¬nh pháº£i truyá»n db, nÃªn nÃ³ sáº½ in ra cÃ¡c cá»™t á»©ng vá»›i tá»«ng table.

NhÆ° váº­y mÃ¬nh cáº§n láº¥y **`content`** trong table **`secret6`** 

![image.png](/assets/images/WPT/SQLi/image%2019.png)

## ğŸ§ª Level 7

---

![image.png](/assets/images/WPT/SQLi/image%2020.png)

Äáº¿n level 7 nÃ y thÃ¬ mÃ¬nh cÃ³ thÃªm chá»©c nÄƒng **`Register`** 

Cho nÃªn mÃ¬nh thá»±c hiá»‡n register 1 account. 

![image.png](/assets/images/WPT/SQLi/image%2021.png)

![image.png](/assets/images/WPT/SQLi/image%2022.png)

Sau Ä‘Ã³ mÃ¬nh cÃ³ chá»©c nÄƒng show email.

![image.png](/assets/images/WPT/SQLi/image%2023.png)

Chuyá»ƒn sang review source code. Táº¡i trang **`level7.php`** 

![image.png](/assets/images/WPT/SQLi/image%2024.png)

á» Ä‘Ã¢y Ä‘Ã£ thay Ä‘á»•i cÃ¡ch mÃ  cÃ¢u query thá»±c hiá»‡n, dev Ä‘Ã£ thay Ä‘á»•i thÃ nh prepare statement. NghÄ©a lÃ  khi mÃ¬nh nháº­p thÃ¬ input Ä‘i vÃ o nhá»¯ng nÆ¡i Ä‘Æ°á»£c binding chá»© khÃ´ng cÃ²n pháº£i ná»‘i chuá»—i ná»¯a. NÃªn mÃ¬nh hoÃ n toÃ n khÃ´ng thá»ƒ thao tÃ¡c Ä‘Ã³ng chuá»—i Ä‘á»ƒ ná»‘i dÃ i. 

NhÆ°ng quan sÃ¡t táº¡i dÃ²ng 17 thÃ¬ nÃ³ lÆ°u session **`username`** cÃ³ thá»ƒ lÃ  Ä‘á»ƒ thá»±c hiá»‡n gÃ¬ Ä‘Ã³. Sau Ä‘Ã³ mÃ¬nh quan sÃ¡t **`profile.php`** 

![image.png](/assets/images/WPT/SQLi/image%2025.png)

Táº¡i Ä‘Ã¢y ta tháº¥y session Ä‘Æ°á»£c gÃ¡n vÃ o biáº¿n **`username`** Ä‘á»ƒ thá»±c hiá»‡n cho cÃ¢u query tÃ¬m ra email. 

NÃªu váº­y thÃ¬ mÃ¬nh Ä‘Äƒng kÃ½ má»™t account vá»›i **`username`** lÃ  **`' UNION SELECT GROUP_CONCAT(password) FROM users WHERE username='admin'#`** thÃ¬ sao â“â“ 

![image.png](/assets/images/WPT/SQLi/image%2026.png)

Sau Ä‘Ã³ mÃ¬nh thá»±c hiá»‡n login vÃ o.

![image.png](/assets/images/WPT/SQLi/image%2027.png)

Tiáº¿p theo mÃ¬nh check email â†’ nÃ³ in ra **`password`** cá»§a admin.

![image.png](/assets/images/WPT/SQLi/image%2028.png)

## ğŸ§ª Level 8

---

TÆ°Æ¡ng tá»± nhÆ° level 7 thÃ¬ mÃ¬nh Ä‘Äƒng kÃ½ 1 account.

![image.png](/assets/images/WPT/SQLi/image%2029.png)

Sau khi vÃ o thÃ¬ mÃ¬nh cÃ³ chá»©c nÄƒng update email.

MÃ¬nh sáº½ Ä‘á»c source cá»§a nÃ³. 

![image.png](/assets/images/WPT/SQLi/image%2030.png)

NÃ³ váº«n tÆ°Æ¡ng tá»± nhÆ° level7 vÃ  chá»‰ khÃ¡c lÃ  gá»i file **`update.php`** 

![image.png](/assets/images/WPT/SQLi/image%2031.png)

NÃ³ váº«n lÆ°u **`username`** dÆ°á»›i dáº¡ng session sau Ä‘Ã³ Ä‘Æ°á»£c truyá»n vÃ o cÃ¢u query 16.

NhÆ° váº­y dá»±a vÃ o cÃ¡ch viáº¿t nhÆ° nÃ y thÃ¬ mÃ¬nh cÃ³ thá»ƒ update **`password`** thay vÃ¬ update **`email`** cho user **`admin`.**

Äáº§u tiÃªn mÃ¬nh Ä‘Äƒng kÃ­ **`username`** lÃ  **`admin'#`** 

![image.png](/assets/images/WPT/SQLi/image%2032.png)

Sau Ä‘Ã³ mÃ¬nh login vÃ o. 

![image.png](/assets/images/WPT/SQLi/image%2033.png)

Äáº¿n vá»›i chá»©c nÄƒng **`update`.**

![image.png](/assets/images/WPT/SQLi/image%2034.png)

MÃ¬nh pháº£i update hash cá»§a **`1`** vÃ¬ password Ä‘Æ°á»£c lÆ°u dÆ°á»›i dáº¡ng md5.

Giá» thÃ¬ mÃ¬nh login vÃ o dÆ°á»›i tÃ i khoáº£n admin vá»›i password lÃ  **`1`** 

![image.png](/assets/images/WPT/SQLi/image%2035.png)